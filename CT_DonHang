
package BookStore;
import java.util.ArrayList;
import java.util.Random;
import java.util.Scanner;

public class CT_DonHang {
    private String maDonHang;
    private KhachHang khachHang;
    private String diaChi;
    private String ngayDH;
    private String ptThanhToan;
    private int trangThai; //0: chưa đặt hàng; 1: chờ xử lý (đã đặt hàng); 2: đã xử lý , 3: đang giao; 4: đã nhận hàng; 5: đã huỷ đơn
    private Double tongTien;
    private ArrayList<Sach> dsSanPham= new ArrayList<>();
    Scanner scan = new Scanner(System.in);
    
    public CT_DonHang() {
    }

    public CT_DonHang(String maDonHang, KhachHang khachHang, String diaChi, String ngayDH, String ptThanhToan, int trangThai, Double tongTien, ArrayList<Sach> dsSanPham) {
        this.maDonHang = maDonHang;
        this.khachHang = khachHang;
        this.diaChi = diaChi;
        this.ngayDH = ngayDH;
        this.ptThanhToan = ptThanhToan;
        this.trangThai = trangThai;
        this.tongTien = tongTien;
        this.dsSanPham = dsSanPham;
    }
   
    public String taoMaDH() {
        Random rand = new Random();
        int soNgauNhien = rand.nextInt(1000000); 
        String maSoNgauNhien = String.format("%06d", soNgauNhien);
        
        String maDonHang = "DH" + this.getKhachHang().getMaKH() + maSoNgauNhien;
        return maDonHang;
    }
    
    public String getMaDonHang() {
        return maDonHang;
    }

    public void setMaDonHang(String maDonHang) {
        this.maDonHang = maDonHang;
    }

    public String getDiaChi() {
        return diaChi;
    }

    public void setDiaChi(String diaChi) {
        this.diaChi = diaChi;
    }

    public String getNgayDH() {
        return ngayDH;
    }

    public void setNgayDH(String ngayDH) {
        this.ngayDH = ngayDH;
    }

    public String getPtThanhToan() {
        return ptThanhToan;
    }

    public void setPtThanhToan(String ptThanhToan) {
        this.ptThanhToan = ptThanhToan;
    }

    public Double getTongTien() {
        return tongTien;
    }

    public void setTongTien(Double tongTien) {
        this.tongTien = tongTien;
    }
    
    public int getTrangThai() {
        return trangThai;
    }

    public void setTrangThai(int trangThai) {
        this.trangThai = trangThai;
    }

    public KhachHang getKhachHang() {
        return khachHang;
    }

    public void setKhachHang(KhachHang khachHang) {
        this.khachHang = khachHang;
    }

    public ArrayList<Sach> getDsSanPham() {
        return dsSanPham;
    }

    public void setDsSanPham(Sach sach) {
        this.dsSanPham.add(sach);
    }
    
    public Double tinhTongTien() {
        for (Sach sach : dsSanPham) {
        tongTien += sach.getDonGia()* sach.getSoLuongMua();
        }
        return tongTien;
    }
    
    //Chưa có trường hợp khách mua sách điện tử phải bắt buộc thanh toán chuyển khoản
    public String chonPTTT() {
        String ptThanhToan = new String();
        for (Sach sach : dsSanPham) {
            if (sach.getLoaiSach().equalsIgnoreCase("Mem")) {
                System.out.println("Phương thức thanh toán: chuyển khoản (Mặc định)");
                ptThanhToan = "chuyển khoản";
                break;
            }
        }
        int chon=0;
        do {
            try {

                System.out.println(" Chọn phương thức thanh toán: ");
                System.out.println("1. Tiền mặt || 2. Chuyển khoản ");
                chon = Integer.parseInt(scan.nextLine());
                    if (chon == 1) {
                        ptThanhToan = "tiền mặt";
                        break;
                    }
                    if (chon == 2) {
                        ptThanhToan = "chuyển khoản";
                        break;
                    }   
                if (chon < 1 || chon > 2)
                System.out.println(" Vui long chon phuong thuc thanh toan! ");
            } catch(NumberFormatException e)
                {
                    System.out.println("Vui lòng chọn đúng các thao tác đã hiển thị!!!");
                }
                catch ( Exception e)
                {
                    System.out.println(e.getMessage());
                }
            } while (chon != 2);
        return ptThanhToan;
    }
    
    
//    public double giamGia() {
//        if (this.tinhTongTien() >= 500000) {
//            return (10/100)*this.tinhTongTien();
//        } else { 
//            if (this.tinhTongTien() >= 300000) {
//                return (5/100)*this.tinhTongTien();
//            } else return 0;
//        }
//    }
//        
//    public double giaSauKhiGiam() {
//        this.tongTien = this.tinhTongTien() - this.giamGia();
//        return this.tongTien;
//    }
    
    public String chonDiaChi() {
        
        return diaChi;
    }
    
    public void setInfo() {
        System.out.println("-----THÔNG TIN ĐẶT HÀNG-----");
        this.chonDiaChi();
        this.getKhachHang().getEmail();
        this.chonPTTT();
        this.setTrangThai(0);
    }
     
    @Override
    public String toString() {
       if (this.getTrangThai() == 0 || this.getDsSanPham()== null) return " ";
       StringBuilder sb = new StringBuilder();
       sb.append("\n");
       sb.append("Mã khách hàng: ").append(this.getKhachHang().getMaKH()).append("\n");
       sb.append("Mã đơn: ").append(this.getMaDonHang()).append("\n");
       sb.append("Email: ").append(this.getKhachHang().getEmail()).append("\n");
       sb.append("Địa chỉ: ").append(this.getDiaChi()).append("\n");
       sb.append("Ngày đặt hàng: ").append(this.getNgayDH()).append("\n");
       sb.append("Mô tả sản phẩm: \n");
       for (int i = 0; i < this.dsSanPham.size(); i++) {
           sb.append(i+1).append(this.dsSanPham.get(i).getTenSach()).append(" x").append(this.dsSanPham.get(i).getSoLuongMua()).append("\n");
       }
       sb.append("Tổng tiền: ").append(this.getTongTien()).append("\n");
       sb.append("Phương thức thanh toán: ").append(this.getPtThanhToan()).append("\n");
       sb.append("Trạng thái: ").append(this.getTrangThai()).append("\n");
       return sb.toString();
        
    }

        public static void main(String[] args) {
        CT_DonHang donhang = new CT_DonHang();
        donhang.setInfo();
        System.out.println(donhang.toString());
    }

}

