
package BookStore;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.Scanner;

public class DonHang {
    private ArrayList<CT_DonHang> dsDonHang = new ArrayList<>();

    public DonHang() {
    }

    public ArrayList<CT_DonHang> getDsDonHang() {
        return dsDonHang;
    }

    public void setDsDonHang(ArrayList<CT_DonHang> dsDonHang) {
        this.dsDonHang = dsDonHang;
    }

    public void timKiemDonHangTheoMaDon() {
    }
    
    //Tìm kiếm đơn hàng theo MaKH, thống kê số lượng 
    public void timKiemDonHangTheoMaKhach() {
    }

    
    public void datHang() {
        for (CT_DonHang donhang : dsDonHang) {
            if (null!= donhang.getDsSanPham()) {
                donhang.setInfo();
                System.out.println("--BẠN CÓ XÁC NHẬN ĐẶT HÀNG?--");
                System.out.println("1. Đồng ý đặt hàng");
                System.out.println("2. Xem thêm sản phẩm");
                int chon = 0;
                do {
                    Scanner scan = new Scanner(System.in);
                    chon = Integer.parseInt(scan.nextLine());
                    switch (chon) {
                        case 1:
                            donhang.setTrangThai(1);
                            donhang.setMaDonHang(donhang.taoMaDH());
                            donhang.getDsSanPham();
                            donhang.setTongTien(donhang.tinhTongTien()); 
                            LocalDateTime myDateObj = LocalDateTime.now();   
                            DateTimeFormatter myFormatObj = DateTimeFormatter.ofPattern("dd/MM/yyyy");
                            donhang.setNgayDH(myDateObj.format(myFormatObj));
                            try (FileWriter fileWriter = new FileWriter("DonHang.txt", true)) {
                                    StringBuilder sb = new StringBuilder();
                                    sb.append(donhang.getKhachHang().getMaKH()).append("#");
                                    sb.append(donhang.getMaDonHang()).append("#");
                                    sb.append(donhang.getKhachHang().getEmail()).append("#");
                                    sb.append(donhang.chonDiaChi()).append("#");
                                    sb.append(donhang.getNgayDH()).append("#");
                                    ArrayList<Sach> dsSanPham = donhang.getDsSanPham();
                                    for (Sach sach : dsSanPham) {
                                        sb.append(sach.getTenSach()).append(" x").append(sach.getSoLuongMua()).append(";");
                                    }
                                    sb.append("#");
                                    sb.append(donhang.tinhTongTien()).append("#");
                                    sb.append(donhang.getTrangThai()).append("#");
                                    sb.append(System.lineSeparator()); //Xuống dòng
                                    fileWriter.write(sb.toString()); //Ghi chuỗi thông tin vào file
                                    fileWriter.flush(); 
                                    System.out.println("ĐẶT HÀNG THÀNH CÔNG!");
                                    //phương thức cập nhật số lượng sách tồn kho
                            }
                                catch (IOException e) {
                                    System.out.println("\n ĐẶT HÀNG KHÔNG THÀNH CÔNG! \n");
                                    System.out.println("Có lỗi khi ghi vào file: " + e.getMessage());
                            }
                            break;
                        case 2:
                             //ve trang chu    
                    }
                    if (chon < 1 || chon > 2)
                            System.out.println("\n Vui lòng xác nhận đặt hàng! \n");
                } while (chon != 3);
            }
        }
    }
    
//     public ArrayList<DonHang> docDonHangTuFile() {
//		File file = new File("DonHang.txt");
//		ArrayList<DonHang> dsDonHang = new ArrayList<>();
//		try (Scanner scanner = new Scanner(file)) {
//			while (scanner.hasNextLine()) {
//				String line = scanner.nextLine();
//				String[] donHangFile = line.split("#");
//				String maDonHang = donHangFile[0];
//				String maKhachHang = donHangFile[1];
//				String diaChi = donHangFile[2];
//				String email = donHangFile[3];
//				String ngayDH = donHangFile[4];
//				String ptThanhToan = donHangFile[5];
//				String tongTien = donHangFile[6];
//				String trangThai = donHangFile[7];
//				String[] dsSanPhamString = donHangFile[8].split(";");
//				ArrayList<Sach> dsSanPham = new ArrayList<>();
//				for (String dulieuSach : dsSanPhamString) {
//					String[] temp = dulieuSach.split("x");
//					Sach sach = new Sach(temp[0], Integer.parseInt(temp[1]));
//					dsSanPham.add(sach);
//				}
//			}
//		} catch (FileNotFoundException e) {
//			System.out.println("Khong tim duoc file: " + e.getMessage());
//		} catch (Exception e) {
//			System.out.println("Da co loi xay ra: " + e.getMessage());
//		}
//		return dsDonHang;
//	}
//    
    
    
}
